<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Clean&Dry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/auth.js" defer></script>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-blue-600">Clean&Dry</a>
            <div class="flex items-center space-x-4">
                <span id="userWelcome" class="text-gray-700"></span>
                <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Logout</button>
            </div>
        </div>
    </header>

    <!-- Dashboard Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div id="loadingScreen" class="text-center py-12">
            <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p>Loading dashboard...</p>
        </div>

        <div id="dashboardContent" class="hidden">
            <!-- Customer Dashboard -->
            <div id="customerDashboard" class="hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Customer Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">Book a Service</h3>
                        <p class="text-gray-600 mb-4">Schedule a car wash or detailing service</p>
                        <a href="booking.html" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Book Now</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">My Orders</h3>
                        <p class="text-gray-600 mb-4">View your current and past orders</p>
                        <a href="orders.html" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">View Orders</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">Profile</h3>
                        <p class="text-gray-600 mb-4">Manage your account settings</p>
                        <a href="profile.html" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Edit Profile</a>
                    </div>
                </div>
            </div>

            <!-- Washer Dashboard -->
            <div id="washerDashboard" class="hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Washer Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">Incoming Orders</h3>
                        <p class="text-gray-600 mb-4">View and accept new service requests</p>
                        <a href="orders.html" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">View Orders</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">My Services</h3>
                        <p class="text-gray-600 mb-4">Manage your service offerings</p>
                        <a href="services.html" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Manage Services</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-2">Earnings</h3>
                        <p class="text-gray-600 mb-4">Track your income and payments</p>
                        <a href="earnings.html" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">View Earnings</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            if (!requireAuth()) return;

            const user = authManager.getCurrentUser();
            
            // Update welcome message
            document.getElementById('userWelcome').textContent = `Welcome, ${user.name}`;
            // In home.html script
            const token = localStorage.getItem('token');
            if (!token) {
              window.location.href = 'login.html';
            }

            // To call protected API (e.g., check-auth)
            const response = await fetch('http://127.0.0.1:8000/api/check-auth', {
              headers: { 'Authorization': `Bearer ${token}` }
            });
            // Show appropriate dashboard based on role
            if (user.role === 'customer') {
                document.getElementById('customerDashboard').classList.remove('hidden');
            } else if (user.role === 'washer') {
                document.getElementById('washerDashboard').classList.remove('hidden');
            }
            
            // Show dashboard content
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
        });
    </script>
</body>
</html>